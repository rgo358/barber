name: ğŸ” Quality Checks

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  quality:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.8'

    - name: ğŸ” Check Python syntax
      run: |
        echo "ğŸ” Checking Python syntax..."
        python3 -m py_compile $(find . -name "*.py" -type f)
        echo "âœ… Python syntax OK"

    - name: ğŸ“ Check file sizes
      run: |
        echo "ğŸ“ Checking file sizes..."
        find . -type f -size +50M ! -path './.git/*' ! -path './venv/*' -exec ls -lh {} \;
        [ $(find . -type f -size +50M ! -path './.git/*' ! -path './venv/*' | wc -l) -eq 0 ] || exit 1
        echo "âœ… File sizes OK"

    - name: ğŸ” Check for secrets
      run: |
        echo "ğŸ” Checking for secrets..."
        git diff origin/main HEAD | grep -i -E '(token|password|secret|api.key|api_key)' && exit 1 || true
        echo "âœ… No secrets detected"

    - name: ğŸ“ Validate JSON
      run: |
        echo "ğŸ“ Validating JSON files..."
        for file in $(find . -name "*.json" -type f); do
          python3 -m json.tool "$file" > /dev/null || exit 1
        done
        echo "âœ… JSON validation OK"

    - name: âœ… Git status check
      run: |
        echo "âœ… Git status check..."
        git status
        [ -z "$(git status --porcelain)" ] || echo "âš ï¸  Working directory not clean (expected)"

    - name: ğŸ“Š Summary
      run: |
        echo "=== QUALITY CHECK SUMMARY ==="
        echo "âœ… Python syntax: OK"
        echo "âœ… File sizes: OK"
        echo "âœ… Secrets: None detected"
        echo "âœ… JSON: Valid"
        echo "==============================="
